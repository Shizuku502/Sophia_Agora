<!-- forum/post_detail.html -->
{% extends 'forum/base.html' %}
{% block title %}{{ post.title }} - Sophia Agora{% endblock %}
{% block content %}
<div class="container">
    <h2>{{ post.title }}</h2>
    <p class="meta">
        ç”± <span class="author">{{ post.user.display_name }}</span> ç™¼è¡¨æ–¼
        <span>{{ post.created_at|utc_span }}</span>
    </p>
    <div class="post-content">{{ post.content|safe }}</div>
    <div class="reaction-buttons" data-post-id="{{ post.id }}">
        <button class="reaction-btn like" data-type="like">ğŸ‘ <span class="like-count">{{ post.like_count }}</span></button>
        <button class="reaction-btn dislike" data-type="dislike">ğŸ‘ <span class="dislike-count">{{ post.dislike_count }}</span></button>
    </div>
    <hr>
    <h3>ç•™è¨€</h3>
    {% if current_user.is_authenticated %}
        <form action="{{ url_for('comment.add_comment') }}" method="post">
            <input type="hidden" name="post_id" value="{{ post.id }}">
            <textarea name="content" rows="3" placeholder="ç•™ä¸‹ä½ çš„å›æ‡‰..." required></textarea>
            <button type="submit">ç•™è¨€</button>
        </form>
    {% else %}
        <p><a href="{{ url_for('auth.login') }}">ç™»å…¥</a>å¾Œæ‰èƒ½ç•™è¨€ã€‚</p>
    {% endif %}
    <hr>
    <h3>ç•™è¨€å€</h3>
    <div class="comments">
        {% for comment in post.comments %}
            <div class="comment">
                <p><strong>{{ comment.user.display_name }}</strong>ï¼š{{ comment.content }}</p>
                <div class="reaction-buttons" data-comment-id="{{ comment.id }}">
                    <button class="reaction-btn like" data-type="like">ğŸ‘ <span class="like-count">{{ comment.like_count }}</span></button>
                    <button class="reaction-btn dislike" data-type="dislike">ğŸ‘ <span class="dislike-count">{{ comment.dislike_count }}</span></button>
                </div>
                <p class="meta">
                    <span>{{ comment.created_at|utc_span }}</span>
                    {% if current_user.is_authenticated and (current_user.id == comment.user_id or current_user.is_admin) %}
                        <form method="POST" action="{{ url_for('comment.delete_comment', comment_id=comment.id) }}" class="inline-form">
                            <button type="submit" onclick="return confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ç•™è¨€å—ï¼Ÿ')">åˆªé™¤</button>
                        </form>
                    {% endif %}
                </p>
            </div>
        {% else %}
            <p>ç›®å‰å°šç„¡ç•™è¨€ï¼Œæ­¡è¿ç•™è¨€ç™¼è¡¨çœ‹æ³•ï¼</p>
        {% endfor %}
    </div>
</div>
{% endblock %}
{% block scripts %}
    {{ super() }}
{% endblock %}