<!-- app/teacher/templates/teacher/profile.html -->

{% extends 'base.html' %}

{% block title %}{{ user.nickname }} çš„æ•™å¸«å€‹äººè³‡æ–™{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/teacher_profile.css') }}">
{% endblock %}

{% block content %}
<div class="profile-container">

    <!-- ğŸ‘¤ åŸºæœ¬è³‡è¨Š -->
    <form method="POST" enctype="multipart/form-data" id="profile-form" class="profile-edit-form">
        <div class="avatar-section">
            <img src="{{ user.avatar_url or url_for('static', filename='images/default_avatar.png') }}" class="avatar-lg" alt="é ­åƒ">
            <label class="form-label">æ›´æ›é ­åƒï¼š
                <input type="file" name="avatar" accept="image/*">
            </label>
        </div>

        <div class="form-group">
            <label for="nickname">åç¨±ï¼š</label>
            <input type="text" name="nickname" id="nickname" value="{{ user.nickname }}" required>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="email">é›»å­ä¿¡ç®±ï¼š</label>
                <input type="email" name="email" id="email" value="{{ user.email or '' }}">
            </div>
            <div class="form-group">
                <label for="extension">åˆ†æ©Ÿè™Ÿç¢¼ï¼š</label>
                <input type="text" name="extension" id="extension" value="{{ user.extension or '' }}">
            </div>
        </div>

        <div class="form-info">å¸³è™Ÿ IDï¼š{{ user.account_id }}</div>

        <button type="submit" class="btn-submit">å„²å­˜è®Šæ›´</button>
    </form>
    
    <!-- ğŸ“Š çµ±è¨ˆè³‡è¨Š -->
    <div class="profile-section">
        <h3>çµ±è¨ˆè³‡è¨Š</h3>
        <ul class="stats-list">
            <li>æ–‡ç« æ•¸ï¼š<strong>{{ posts | length }}</strong></li>
            <li>ç•™è¨€æ•¸ï¼š<strong>{{ comments | length }}</strong></li>
            <li>ç²å¾—ç¸½è®šæ•¸ï¼š<strong>{{ total_likes }}</strong></li>
            <li>è²æœ›åˆ†æ•¸ï¼š<strong>{{ user.points }}</strong></li>
        </ul>
    </div>

    {% if user.points < 80 %}
    <div class="alert alert-danger" style="margin-top: 1rem;">
        âš ï¸ æ‚¨çš„å¸³è™Ÿè©•åˆ†ç‚º {{ user.points }} åˆ†ï¼Œå·²é”æ‡²è™•é–€æª»ï¼Œäº’å‹•åŠŸèƒ½å¯èƒ½å—é™ã€‚
    </div>
    {% endif %}

    <!-- ğŸ§  ç ”ç©¶å°ˆé•· -->
    <div class="profile-section">
        <h3>ç ”ç©¶å°ˆé•·</h3>
        <a href="{{ url_for('teacher.add_expertise') }}" class="btn">â• æ–°å¢å°ˆé•·</a>
        {% if expertises %}
            <ul class="expertise-list">
                {% for expertise in expertises %}
                <li data-id="{{ expertise.id }}">
                    <div class="expertise-item">
                        <span class="field-text">{{ expertise.field }}</span>
                        <input type="text" class="field-input" value="{{ expertise.field }}" style="display: none;">
                        <button class="btn btn-sm btn-edit-expertise">ç·¨è¼¯</button>
                        <button class="btn btn-sm btn-save-expertise" style="display: none;">å„²å­˜</button>
                        <button class="btn btn-sm btn-cancel-expertise" style="display: none;">å–æ¶ˆ</button>
                        <button type="button" class="btn btn-sm btn-delete-expertise" data-expertise-id="{{ expertise.id }}">ğŸ—‘ åˆªé™¤</button>
                    </div>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="empty-message">å°šæœªå¡«å¯«ç ”ç©¶å°ˆé•·ã€‚</p>
        {% endif %}
    </div>

    <!-- ğŸ“ ç ”ç©¶ / è«–æ–‡ -->
    <div class="profile-section research">
        <h3>ç ”ç©¶ / è«–æ–‡</h3>
        <a href="{{ url_for('teacher.add_paper') }}" class="btn">â• æ–°å¢è«–æ–‡</a>
        {% if papers %}
            <ul class="paper-list">
                {% for paper in papers %}
                    <li>
                        {{ paper.year }} - {{ paper.title }} ({{ paper.paper_type }})
                        <a href="{{ url_for('teacher.edit_paper', paper_id=paper.id) }}" class="btn btn-sm btn-edit-paper">ç·¨è¼¯</a>
                        <button type="button" class="btn btn-sm btn-delete-paper" data-paper-id="{{ paper.id }}">ğŸ—‘ åˆªé™¤</button>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="empty-message">å°šæœªå¡«å¯«ç ”ç©¶æˆ–è«–æ–‡è³‡æ–™ã€‚</p>
        {% endif %}
    </div>

    <!-- ğŸ§³ æ•™å­¸ / å·¥ä½œç¶“æ­· -->
    <div class="profile-section" id="experience-section">
        <h3>ç¶“æ­·</h3>
        <a href="{{ url_for('teacher.add_experience') }}" class="btn">â• æ–°å¢ç¶“æ­·</a>
        {% if experiences %}
            <ul id="experience-list">
                {% for experience in experiences %}
                    <li data-id="{{ experience.id }}">
                        <div class="experience-left">
                            <span class="experience-badge">{{ experience.category }}</span>
                            <span class="experience-description">{{ experience.description }}</span>
                        </div>
                        <button class="btn btn-sm btn-edit-experience">ç·¨è¼¯</button>
                        <button class="btn-delete-experience" data-experience-id="{{ experience.id }}">åˆªé™¤</button>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="empty-message">å°šæœªå¡«å¯«ç›¸é—œç¶“æ­·ã€‚</p>
        {% endif %}
    </div>

    <!-- ç·¨è¼¯ç¶“æ­·è¡¨å–®ï¼Œé è¨­éš±è— -->
    <div id="edit-experience-form" style="display:none; margin-top: 1em;">
        <h4>ç·¨è¼¯ç¶“æ­·</h4>
        <form id="experience-edit-form">
            <input type="hidden" name="id" id="edit-exp-id" />
            <label for="edit-category">é¡åˆ¥</label>
            <select name="category" id="edit-category" required>
                <option value="">-- è«‹é¸æ“‡é¡åˆ¥ --</option>
                <option value="æ ¡å…§">æ ¡å…§</option>
                <option value="æ ¡å¤–">æ ¡å¤–</option>
            </select>
            <br/>
            <label for="edit-description">ç¶“æ­·æè¿°</label>
            <textarea name="description" id="edit-description" rows="4" required></textarea>
            <br/>
            <button type="submit" class="btn">æ›´æ–°</button>
            <button type="button" id="cancel-edit" class="btn btn-cancel">å–æ¶ˆ</button>
        </form>
    </div>

</div>

{% block scripts %}
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/edit_teacher_profile.js') }}"></script>
    <script src="{{ url_for('static', filename='js/edit_experience.js') }}"></script>
    <script src="{{ url_for('static', filename='js/edit_expertise.js') }}"></script>
    <script src="{{ url_for('static', filename='js/delete_expertise.js') }}"></script>
    <script src="{{ url_for('static', filename='js/delete_paper.js') }}"></script>
    <script src="{{ url_for('static', filename='js/delete_experience.js') }}"></script>
{% endblock %}
{% endblock %}
